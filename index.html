<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Daily Crossword</title>
<style>
:root{
  --teal:#1f9dbf;--gold:#f5b041;--gray:#ddd;--bg:#fafafa;--shade:#f8f5ef;
}
body{font-family:Arial,Helvetica,sans-serif;margin:0;padding:0;background:var(--bg);color:#222;}
.wrapper{max-width:950px;margin:auto;padding:12px;text-align:center;}
h1{color:var(--teal);margin:.3em 0 .1em;font-size:1.8em;}
h2{color:#555;font-size:1.1em;margin:0 0 .8em;font-weight:normal;}
p.instructions{font-style:italic;color:#666;margin-top:-4px;}
.grid-area{display:flex;flex-direction:column;align-items:center;}
.grid{
  display:grid;gap:2px;
  grid-template-columns:repeat(15, minmax(20px,1fr));
  max-width:95vw;
  background:var(--gray);
  border:2px solid var(--gray);
}
.cell{
  position:relative;
  background:white;
  aspect-ratio:1/1;
  border:1px solid var(--gray);
  font-weight:bold;
  text-transform:uppercase;
}
.cell.black{background:var(--gold);}
.cell input{
  width:100%;height:100%;
  text-align:center;
  font-size:clamp(12px,3vw,20px);
  border:none;
  background:transparent;
  font-weight:bold;
  text-transform:uppercase;
  outline:none;
}
.num{position:absolute;top:2px;left:3px;font-size:clamp(7px,1.5vw,11px);color:#444;}
.controls{
  margin:16px 0 24px;
  display:flex;justify-content:center;gap:10px;flex-wrap:wrap;
  position:sticky;bottom:8px;background:var(--bg);padding:6px 0;z-index:50;
}
button{border:0;padding:10px 16px;border-radius:10px;font-weight:bold;cursor:pointer;}
.btn-clear{background:var(--gold);color:#222;}
.toast{
  position:fixed;bottom:20px;left:50%;transform:translateX(-50%);
  background:var(--teal);color:#fff;padding:8px 14px;border-radius:8px;
  opacity:0;transition:opacity .3s ease;z-index:999;
}
.toast.show{opacity:1;}
.clues{display:flex;flex-wrap:wrap;gap:20px;justify-content:center;text-align:left;margin-top:14px;}
.clues div{flex:1 1 300px;max-width:420px;}
.clues h3{color:var(--teal);margin-bottom:6px;}
.clues ul{padding-left:20px;margin:0;}
.clues li{margin-bottom:5px;}
@media(max-width:600px){
  .grid{grid-template-columns:repeat(15, minmax(16px,1fr));gap:1px;}
  .cell input{font-size:clamp(10px,3vw,16px);}
  .controls{bottom:4px;padding:8px 0;}
}
</style>
</head>
<body>
<div class="wrapper">
  <h1 id="title">Daily Crossword</h1>
  <h2 id="subtitle"></h2>
  <p class="instructions">Tap to fill in the squares. Progress saves automatically.</p>
  <div class="grid-area">
    <div id="grid" class="grid"></div>
  </div>
  <div class="controls">
    <button class="btn-clear" id="clearBtn">Clear My Answers</button>
  </div>
  <div id="clues" class="clues"></div>
</div>
<div id="toast" class="toast">Progress Saved</div>

<script>
const puzzleURL = "./puzzle.json";
const gridEl = document.getElementById('grid');
const cluesEl = document.getElementById('clues');
const toast = document.getElementById('toast');
const LS_KEY = "crossword-progress";

fetch(puzzleURL)
.then(r=>r.json())
.then(data=>{
  document.getElementById('title').textContent = data.title || "Daily Crossword";
  document.getElementById('subtitle').textContent = data.subtitle || "";
  const {rows,cols,grid,numbers,across,down}=data;
  gridEl.style.gridTemplateColumns=`repeat(${cols},1fr)`;
  gridEl.innerHTML="";
  for(let r=0;r<rows;r++){
    for(let c=0;c<cols;c++){
      const cell=document.createElement("div");
      cell.className="cell";
      if(grid[r][c]==="#"){cell.classList.add("black");gridEl.appendChild(cell);continue;}
      const num=numbers[r][c];
      if(num){const n=document.createElement("div");n.className="num";n.textContent=num;cell.appendChild(n);}
      const inp=document.createElement("input");
      inp.maxLength=1;
      const key=`${r}-${c}`;
      inp.value=loadProgress()[key]||"";
      inp.addEventListener("input",()=>{saveProgress(key,inp.value.toUpperCase());showToast("Progress Saved");});
      cell.appendChild(inp);
      gridEl.appendChild(cell);
    }
  }
  // Clues
  let html="";
  html += `<div><h3>Across</h3><ul>`;
  for(const [n,txt] of Object.entries(across||{})){html+=`<li><b>${n}.</b> ${txt}</li>`;}
  html += `</ul></div><div><h3>Down</h3><ul>`;
  for(const [n,txt] of Object.entries(down||{})){html+=`<li><b>${n}.</b> ${txt}</li>`;}
  html += `</ul></div>`;
  cluesEl.innerHTML=html;
})
.catch(err=>{
  gridEl.innerHTML="<p style='color:red'>Crossword Unavailable</p>";
});

function showToast(msg){
  toast.textContent=msg;
  toast.classList.add("show");
  setTimeout(()=>toast.classList.remove("show"),1000);
}
function loadProgress(){
  try{return JSON.parse(localStorage.getItem(LS_KEY)||"{}");}catch(e){return {};}
}
function saveProgress(key,val){
  const data=loadProgress();
  data[key]=val;
  localStorage.setItem(LS_KEY,JSON.stringify(data));
}
document.getElementById("clearBtn").onclick=()=>{
  localStorage.removeItem(LS_KEY);
  document.querySelectorAll(".cell input").forEach(i=>i.value="");
  showToast("Answers Cleared");
};
</script>
</body>
</html>
